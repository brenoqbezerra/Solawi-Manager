import { useState, useEffect } from 'react';
import { Language } from './types';

const translations = {
  de: {
    // Existing Dashboard Keys
    dashboard: "Übersicht",
    crops: "Kulturen",
    newCrop: "Neue Kultur",
    settings: "Einstellungen",
    activeCrops: "Aktive Kulturen",
    plannedHarvests: "Geplante Ernten",
    weather: "Wetter",
    culture: "Kultur",
    variety: "Sorte",
    plantWeek: "Pflanzwoche (KW)",
    plantYear: "Pflanzjahr",
    harvestWeek: "Erntewoche (KW)",
    harvestYear: "Erntejahr",
    location: "Standort",
    expectedYield: "Erw. Menge",
    status: "Status",
    actions: "Aktionen",
    save: "Speichern",
    cancel: "Abbrechen",
    harvest: "Ernten",
    edit: "Bearbeiten",
    delete: "Löschen",
    loading: "Laden...",
    noCrops: "Keine Kulturen gefunden. Starten Sie jetzt!",
    harvestDue: "Diese Woche fällig",
    harvestOverdue: "Überfällig",
    harvestSoon: "Bald fällig",
    harvested: "Geerntet",
    growing: "Aktiv",
    unit: "Einheit",
    field: "Feld",
    greenhouse: "Gewächshaus",
    tunnel: "Folientunnel",
    week: "Woche",
    today: "Heute",
    totalHarvest: "Gesamternte",
    cropsStarted: "Kulturen gestartet",
    welcome: "Willkommen zurück",
    weatherError: "Wetterdaten nicht verfügbar",
    resetData: "Alle Daten löschen",
    resetConfirm: "Sind Sie sicher? Alle Daten gehen verloren.",
    deleteConfirm: "Möchten Sie diese Kultur wirklich löschen?",
    inProgress: "Aktiv Gesamt",
    dateRange: "Zeitraum",
    quantity: "Menge",
    harvestActionTitle: "Ernte erfassen",
    harvestActionDesc: "Wie viel wurde geerntet?",
    harvestPartial: "Teilernte (Kultur bleibt aktiv)",
    harvestFull: "Volle Ernte (Abschließen)",
    amountHarvested: "Geerntete Menge",
    remainingAmount: "Verbleibende Menge",
    confirm: "Bestätigen",
    plantDate: "Pflanzdatum",
    harvestDate: "Erntedatum",
    unit_kg: "kg",
    unit_units: "Stück",
    unit_bund: "Bund",
    locationPlaceholder: "z.B. Feld 1, Gewächshaus...",
    culturePlaceholder: "z.B. Karotten, Salat...",
    varietyPlaceholder: "z.B. Nantaise...",
    notes: "Notizen",
    notesPlaceholder: "Optionale Notizen hier...",
    year: "Jahr",
    editCrop: "Kultur bearbeiten",
    planned: "Geplant",
    realized: "Realisiert",
    chartTitle: "Ernteübersicht: Geplant vs. Realisiert",
    saveConfirm: "Änderungen speichern?",
    harvestThisWeek: "Ernte diese Woche",
    plantMonth: "Pflanzmonat",
    harvestMonth: "Erntemonat",
    developedBy: "Entwickelt von",

    // Landing Page Keys
    lp_hero_title: "Einfache Anbauplanung für Solidarische Landwirtschaft",
    lp_hero_subtitle: "Kostenloses, lokales Werkzeug für Solawis und kleine Höfe. Offline-first, mehrsprachig und fokussiert auf das Wesentliche.",
    lp_cta_start: "System testen",
    lp_cta_github: "Quellcode ansehen",
    lp_story_title: "Entstanden aus Beobachtung, Neugier und dem Wunsch zu helfen",
    lp_story_wandel: "Am Rande Dresdens, zwischen Roggenfeldern, Schafherden und dem Hühnerwald des Wandelgrunds, entstand die Frage: Wie kann Technologie die Arbeit auf dem Hof vereinfachen — ohne sie zu überlagern?",
    lp_story_wirgarten: "Bei der Recherche stieß ich auf die kluge, analoge Anbauplanung von WirGarten — eine Vorlage, die ich digitalisieren wollte, um sie zugänglicher und mehrsprachig zu machen.",
    lp_story_mvp: "Ein MVP — bewusst einfach, lokal gespeichert, ohne Login. Nicht perfekt, aber nützlich. Und bereit, mit Ihrer Hilfe zu wachsen.",
    lp_global_reach: "Verfügbar in Deutsch, English, Español, Français, Português — denn gute Ideen für solidarische Landwirtschaft kennen keine Grenzen.",
    lp_feat_dashboard: "Dashboard mit Echtzeit-Übersicht (Aktive Kulturen, Geplante Ernten)",
    lp_feat_kw: "KW-basierte Planung mit Jahresübergang",
    lp_feat_harvest: "Erfassung von Ernten mit Menge und Datum",
    lp_feat_weather: "7-Tage-Wettervorhersage + autom. Standort",
    lp_feat_responsive: "Vollständig responsiv — für die Nutzung auf dem Feld",
    lp_footer_links: "Inspiration & Freunde:",
    lp_start_now: "Jetzt starten"
  },
  en: {
    // Existing Dashboard Keys
    dashboard: "Dashboard",
    crops: "Crops",
    newCrop: "New Crop",
    settings: "Settings",
    activeCrops: "Active Crops",
    plannedHarvests: "Planned Harvests",
    weather: "Weather",
    culture: "Crop",
    variety: "Variety",
    plantWeek: "Plant Week",
    plantYear: "Plant Year",
    harvestWeek: "Harvest Week",
    harvestYear: "Harvest Year",
    location: "Location",
    expectedYield: "Exp. Yield",
    status: "Status",
    actions: "Actions",
    save: "Save",
    cancel: "Cancel",
    harvest: "Harvest",
    edit: "Edit",
    delete: "Delete",
    loading: "Loading...",
    noCrops: "No crops found. Start planting!",
    harvestDue: "Due This Week",
    harvestOverdue: "Overdue",
    harvestSoon: "Coming Soon",
    harvested: "Harvested",
    growing: "Active",
    unit: "Unit",
    field: "Field",
    greenhouse: "Greenhouse",
    tunnel: "Polytunnel",
    week: "Week",
    today: "Today",
    totalHarvest: "Total Harvest",
    cropsStarted: "Crops Started",
    welcome: "Welcome back",
    weatherError: "Weather data unavailable",
    resetData: "Reset All Data",
    resetConfirm: "Are you sure? All data will be lost.",
    deleteConfirm: "Are you sure you want to delete this crop?",
    inProgress: "Active Total",
    dateRange: "Date Range",
    quantity: "Quantity",
    harvestActionTitle: "Record Harvest",
    harvestActionDesc: "How much was harvested?",
    harvestPartial: "Partial Harvest (Keep Active)",
    harvestFull: "Full Harvest (Complete)",
    amountHarvested: "Amount Harvested",
    remainingAmount: "Remaining Expected",
    confirm: "Confirm",
    plantDate: "Planting Date",
    harvestDate: "Harvest Date",
    unit_kg: "kg",
    unit_units: "units",
    unit_bund: "bundles",
    locationPlaceholder: "e.g. Field 1, Greenhouse...",
    culturePlaceholder: "e.g. Carrots, Lettuce...",
    varietyPlaceholder: "e.g. Nantaise...",
    notes: "Notes",
    notesPlaceholder: "Optional notes here...",
    year: "Year",
    editCrop: "Edit Crop",
    planned: "Planned",
    realized: "Realized",
    chartTitle: "Harvest Overview: Planned vs Realized",
    saveConfirm: "Save changes?",
    harvestThisWeek: "Harvest This Week",
    plantMonth: "Plant Month",
    harvestMonth: "Harvest Month",
    developedBy: "Developed by",

    // Landing Page Keys
    lp_hero_title: "Simple Crop Planning for Community Supported Agriculture",
    lp_hero_subtitle: "Free, local tool for CSAs and small farms. Offline-first, multilingual, and focused on the essentials.",
    lp_cta_start: "Try the System",
    lp_cta_github: "View Source",
    lp_story_title: "Created from observation, curiosity, and the desire to help",
    lp_story_wandel: "On the outskirts of Dresden, between rye fields, sheep herds, and the chicken forest of Wandelgrund, the question arose: How can technology simplify work on the farm — without overshadowing it?",
    lp_story_wirgarten: "During research, I came across the clever, analog crop planning of WirGarten — a template I wanted to digitize to make it more accessible and multilingual.",
    lp_story_mvp: "An MVP — consciously simple, stored locally, no login. Not perfect, but useful. And ready to grow with your help.",
    lp_global_reach: "Available in German, English, Spanish, French, Portuguese — because good ideas for solidarity agriculture know no borders.",
    lp_feat_dashboard: "Dashboard with real-time overview (Active Crops, Planned Harvests)",
    lp_feat_kw: "Week-based planning (KW) with year transition",
    lp_feat_harvest: "Harvest recording with quantity and date",
    lp_feat_weather: "7-day weather forecast + auto location",
    lp_feat_responsive: "Fully responsive — for use directly in the field",
    lp_footer_links: "Inspiration & Friends:",
    lp_start_now: "Start Now"
  },
  es: {
    // Existing Dashboard Keys
    dashboard: "Panel",
    crops: "Cultivos",
    newCrop: "Nuevo Cultivo",
    settings: "Configuración",
    activeCrops: "Cultivos Activos",
    plannedHarvests: "Cosechas Planificadas",
    weather: "Clima",
    culture: "Cultivo",
    variety: "Variedad",
    plantWeek: "Sem. Siembra",
    plantYear: "Año Siembra",
    harvestWeek: "Sem. Cosecha",
    harvestYear: "Año Cosecha",
    location: "Ubicación",
    expectedYield: "Ctd. Esperada",
    status: "Estado",
    actions: "Acciones",
    save: "Guardar",
    cancel: "Cancelar",
    harvest: "Cosechar",
    edit: "Editar",
    delete: "Eliminar",
    loading: "Cargando...",
    noCrops: "No se encontraron cultivos.",
    harvestDue: "Para esta semana",
    harvestOverdue: "Atrasado",
    harvestSoon: "Próximamente",
    harvested: "Cosechado",
    growing: "Activo",
    unit: "Unidad",
    field: "Campo",
    greenhouse: "Invernadero",
    tunnel: "Túnel",
    week: "Semana",
    today: "Hoy",
    totalHarvest: "Cosecha Total",
    cropsStarted: "Cultivos Iniciados",
    welcome: "Bienvenido",
    weatherError: "Clima no disponible",
    resetData: "Restablecer Datos",
    resetConfirm: "¿Estás seguro? Se perderán todos los datos.",
    deleteConfirm: "¿Seguro que quieres eliminar este cultivo?",
    inProgress: "Total Activos",
    dateRange: "Fechas",
    quantity: "Cantidad",
    harvestActionTitle: "Registrar Cosecha",
    harvestActionDesc: "¿Cuánto se cosechó?",
    harvestPartial: "Parcial (Mantener Activo)",
    harvestFull: "Total (Finalizar)",
    amountHarvested: "Cantidad Cosechada",
    remainingAmount: "Restante Esperado",
    confirm: "Confirmar",
    plantDate: "Fecha de Siembra",
    harvestDate: "Fecha de Cosecha",
    unit_kg: "kg",
    unit_units: "unidades",
    unit_bund: "manojos",
    locationPlaceholder: "ej. Campo 1, Invernadero...",
    culturePlaceholder: "ej. Zanahorias, Lechuga...",
    varietyPlaceholder: "ej. Nantaise...",
    notes: "Notas",
    notesPlaceholder: "Notas opcionales aquí...",
    year: "Año",
    editCrop: "Editar Cultivo",
    planned: "Planificado",
    realized: "Realizado",
    chartTitle: "Resumen: Planificado vs Realizado",
    saveConfirm: "¿Guardar cambios?",
    harvestThisWeek: "Cosecha esta semana",
    plantMonth: "Mes Siembra",
    harvestMonth: "Mes Cosecha",
    developedBy: "Desarrollado por",

    // Landing Page Keys
    lp_hero_title: "Planificación de Cultivos Simple para Agricultura Solidaria",
    lp_hero_subtitle: "Herramienta gratuita y local para CSAs y pequeñas granjas. Offline-first, multilingüe y enfocada en lo esencial.",
    lp_cta_start: "Probar el Sistema",
    lp_cta_github: "Ver Código",
    lp_story_title: "Concebido a partir de la observación, curiosidad y el deseo de ayudar",
    lp_story_wandel: "En las afueras de Dresde, entre campos de centeno, rebaños de ovejas y el bosque de pollos de Wandelgrund, surgió la pregunta: ¿Cómo puede la tecnología simplificar el trabajo en la granja, sin eclipsarlo?",
    lp_story_wirgarten: "Durante la investigación, encontré la inteligente planificación analógica de WirGarten — una plantilla que quería digitalizar para hacerla más accesible y multilingüe.",
    lp_story_mvp: "Un MVP — conscientemente simple, almacenado localmente, sin inicio de sesión. No es perfecto, pero es útil. Y listo para crecer con tu ayuda.",
    lp_global_reach: "Disponible en alemán, inglés, español, francés y portugués — porque las buenas ideas para la agricultura solidaria no conocen fronteras.",
    lp_feat_dashboard: "Panel con vista en tiempo real (Cultivos activos, Cosechas planificadas)",
    lp_feat_kw: "Planificación basada en semanas (KW) con transición de año",
    lp_feat_harvest: "Registro de cosechas con cantidad y fecha",
    lp_feat_weather: "Pronóstico del tiempo de 7 días + ubicación automática",
    lp_feat_responsive: "Totalmente responsivo — para uso directo en el campo",
    lp_footer_links: "Inspiración y Amigos:",
    lp_start_now: "Comenzar Ahora"
  },
  fr: {
    // Existing Dashboard Keys
    dashboard: "Tableau de bord",
    crops: "Cultures",
    newCrop: "Nouvelle Culture",
    settings: "Paramètres",
    activeCrops: "Cultures Actives",
    plannedHarvests: "Récoltes Prévues",
    weather: "Météo",
    culture: "Culture",
    variety: "Variété",
    plantWeek: "Sem. Plantation",
    plantYear: "Année Plantation",
    harvestWeek: "Sem. Récolte",
    harvestYear: "Année Récolte",
    location: "Emplacement",
    expectedYield: "Rendement Prévu",
    status: "Statut",
    actions: "Actions",
    save: "Enregistrer",
    cancel: "Annuler",
    harvest: "Récolter",
    edit: "Modifier",
    delete: "Supprimer",
    loading: "Chargement...",
    noCrops: "Aucune culture trouvée.",
    harvestDue: "À récolter cette semaine",
    harvestOverdue: "En Retard",
    harvestSoon: "Bientôt",
    harvested: "Récolté",
    growing: "Actif",
    unit: "Unité",
    field: "Champ",
    greenhouse: "Serre",
    tunnel: "Tunnel",
    week: "Semaine",
    today: "Aujourd'hui",
    totalHarvest: "Récolte Totale",
    cropsStarted: "Cultures Lancées",
    welcome: "Bienvenue",
    weatherError: "Météo indisponible",
    resetData: "Réinitialiser",
    resetConfirm: "Êtes-vous sûr ? Toutes les données seront perdues.",
    deleteConfirm: "Voulez-vous vraiment supprimer ?",
    inProgress: "Total Actif",
    dateRange: "Période",
    quantity: "Quantité",
    harvestActionTitle: "Enregistrer la récolte",
    harvestActionDesc: "Combien a été récolté ?",
    harvestPartial: "Partielle (Garder Actif)",
    harvestFull: "Totale (Terminer)",
    amountHarvested: "Quantité Récoltée",
    remainingAmount: "Reste Prévu",
    confirm: "Confirmer",
    plantDate: "Date de Plantation",
    harvestDate: "Date de Récolte",
    unit_kg: "kg",
    unit_units: "pièces",
    unit_bund: "bottes",
    locationPlaceholder: "ex. Champ 1, Serre...",
    culturePlaceholder: "ex. Carottes, Laitue...",
    varietyPlaceholder: "ex. Nantaise...",
    notes: "Notes",
    notesPlaceholder: "Notes optionnelles...",
    year: "Année",
    editCrop: "Modifier Culture",
    planned: "Prévu",
    realized: "Réalisé",
    chartTitle: "Aperçu: Prévu vs Réalisé",
    saveConfirm: "Enregistrer les modifications ?",
    harvestThisWeek: "Récolte cette semaine",
    plantMonth: "Mois Plantation",
    harvestMonth: "Mois Récolte",
    developedBy: "Développé par",

    // Landing Page Keys
    lp_hero_title: "Planification des Cultures Simple pour l'Agriculture Solidaire",
    lp_hero_subtitle: "Outil gratuit et local pour les AMAP et petites fermes. Offline-first, multilingue et concentré sur l'essentiel.",
    lp_cta_start: "Tester le Système",
    lp_cta_github: "Voir le Code",
    lp_story_title: "Né de l'observation, de la curiosité et du désir d'aider",
    lp_story_wandel: "À la périphérie de Dresde, entre champs de seigle, troupeaux de moutons et la forêt de poulets de Wandelgrund, la question s'est posée : Comment la technologie peut-elle simplifier le travail à la ferme — sans l'éclipser ?",
    lp_story_wirgarten: "Lors de mes recherches, je suis tombé sur la planification analogique intelligente de WirGarten — un modèle que je voulais numériser pour le rendre plus accessible et multilingue.",
    lp_story_mvp: "Un MVP — consciemment simple, stocké localement, sans connexion. Pas parfait, mais utile. Et prêt à grandir avec votre aide.",
    lp_global_reach: "Disponible en allemand, anglais, espagnol, français et portugais — car les bonnes idées pour l'agriculture solidaire ne connaissent pas de frontières.",
    lp_feat_dashboard: "Tableau de bord temps réel (Cultures actives, Récoltes prévues)",
    lp_feat_kw: "Planification par semaine (KW) avec transition annuelle",
    lp_feat_harvest: "Enregistrement des récoltes avec quantité et date",
    lp_feat_weather: "Prévisions météo à 7 jours + localisation auto",
    lp_feat_responsive: "Entièrement réactif — pour une utilisation directe au champ",
    lp_footer_links: "Inspiration & Amis:",
    lp_start_now: "Commencer"
  },
  pt: {
    // Existing Dashboard Keys
    dashboard: "Painel",
    crops: "Cultivos",
    newCrop: "Novo Cultivo",
    settings: "Configurações",
    activeCrops: "Cultivos Ativos",
    plannedHarvests: "Colheitas Planejadas",
    weather: "Previsão",
    culture: "Cultura",
    variety: "Variedade",
    plantWeek: "Sem. Plantio",
    plantYear: "Ano Plantio",
    harvestWeek: "Sem. Colheita",
    harvestYear: "Ano Colheita",
    location: "Localização",
    expectedYield: "Qtd. Esperada",
    status: "Status",
    actions: "Ações",
    save: "Salvar",
    cancel: "Cancelar",
    harvest: "Colher",
    edit: "Editar",
    delete: "Excluir",
    loading: "Carregando...",
    noCrops: "Nenhum cultivo encontrado.",
    harvestDue: "Colher esta semana",
    harvestOverdue: "Atrasado",
    harvestSoon: "Em Breve",
    harvested: "Colhido",
    growing: "Ativo",
    unit: "Unidade",
    field: "Campo",
    greenhouse: "Estufa",
    tunnel: "Túnel",
    week: "Semana",
    today: "Hoje",
    totalHarvest: "Colheita Total",
    cropsStarted: "Cultivos Iniciados",
    welcome: "Bem-vindo de volta",
    weatherError: "Clima indisponível",
    resetData: "Resetar Dados",
    resetConfirm: "Tem certeza? Todos os dados serão perdidos.",
    deleteConfirm: "Tem certeza que deseja apagar este cultivo?",
    inProgress: "Ativos Totais",
    dateRange: "Período",
    quantity: "Quantidade",
    harvestActionTitle: "Registrar Colheita",
    harvestActionDesc: "Quanto foi colhido?",
    harvestPartial: "Parcial (Manter Ativo)",
    harvestFull: "Total (Finalizar)",
    amountHarvested: "Quantidade Colhida",
    remainingAmount: "Restante Esperado",
    confirm: "Confirmar",
    plantDate: "Data do Plantio",
    harvestDate: "Data da Colheita",
    unit_kg: "kg",
    unit_units: "unidades",
    unit_bund: "maços",
    locationPlaceholder: "ex: Canteiro 1, Estufa A...",
    culturePlaceholder: "ex: Cenoura, Alface...",
    varietyPlaceholder: "ex: Nantaise...",
    notes: "Anotações",
    notesPlaceholder: "Anotações opcionais aqui...",
    year: "Ano",
    editCrop: "Editar Cultivo",
    planned: "Planejado",
    realized: "Realizado",
    chartTitle: "Visão Geral: Planejado x Realizado",
    saveConfirm: "Salvar alterações?",
    harvestThisWeek: "Colheita esta semana",
    plantMonth: "Mês Plantio",
    harvestMonth: "Mês Colheita",
    developedBy: "Desenvolvido por",

    // Landing Page Keys
    lp_hero_title: "Planejamento de Cultivo Simples para Agricultura Solidária",
    lp_hero_subtitle: "Ferramenta gratuita e local para CSAs e pequenas fazendas. Offline-first, multilíngue e focada no essencial.",
    lp_cta_start: "Testar o Sistema",
    lp_cta_github: "Ver Código",
    lp_story_title: "Concebido a partir da observação, curiosidade e desejo de ajudar",
    lp_story_wandel: "Nos arredores de Dresden, entre campos de centeio, rebanhos de ovelhas e a floresta de galinhas do Wandelgrund, surgiu a pergunta: Como a tecnologia pode simplificar o trabalho na fazenda — sem ofuscá-lo?",
    lp_story_wirgarten: "Durante a pesquisa, encontrei o inteligente planejamento analógico do WirGarten — um modelo que quis digitalizar para tornar mais acessível e multilíngue.",
    lp_story_mvp: "Um MVP — conscientemente simples, salvo localmente, sem login. Não é perfeito, mas é útil. E pronto para crescer com sua ajuda.",
    lp_global_reach: "Disponível em Alemão, Inglês, Espanhol, Francês e Português — porque boas ideias para agricultura solidária não conhecem fronteiras.",
    lp_feat_dashboard: "Dashboard com visão em tempo real (Cultivos Ativos, Colheitas Planejadas)",
    lp_feat_kw: "Planejamento baseado em semanas (KW) com transição de ano",
    lp_feat_harvest: "Registro de colheitas com quantidade e data",
    lp_feat_weather: "Previsão do tempo de 7 dias + localização automática",
    lp_feat_responsive: "Totalmente responsivo — para uso direto no campo",
    lp_footer_links: "Inspiração & Amigos:",
    lp_start_now: "Começar Agora"
  }
};

const listeners = new Set<(lang: Language) => void>();

export const setGlobalLanguage = (lang: Language) => {
  localStorage.setItem('solawi_lang', lang);
  listeners.forEach((l) => l(lang));
};

export const useTranslation = () => {
  const [lang, setLang] = useState<Language>(
    (localStorage.getItem('solawi_lang') as Language) || 'de'
  );

  useEffect(() => {
    const handler = (l: Language) => setLang(l);
    listeners.add(handler);
    return () => {
      listeners.delete(handler);
    };
  }, []);

  const t = (key: keyof typeof translations['de']) => {
    // @ts-ignore
    return translations[lang]?.[key] || translations['en']?.[key] || key;
  };

  return { t, lang, setLang: setGlobalLanguage };
};