import { useState, useEffect } from 'react';
import { Language } from './types';

const translations = {
  de: {
    dashboard: "Übersicht",
    crops: "Kulturen",
    newCrop: "Neue Kultur",
    settings: "Einstellungen",
    activeCrops: "Aktive Kulturen",
    plannedHarvests: "Geplante Ernten",
    weather: "Wetter",
    culture: "Kultur",
    variety: "Sorte",
    plantWeek: "Pflanzwoche (KW)",
    plantYear: "Pflanzjahr",
    harvestWeek: "Erntewoche (KW)",
    harvestYear: "Erntejahr",
    location: "Standort",
    expectedYield: "Erw. Menge",
    status: "Status",
    actions: "Aktionen",
    save: "Speichern",
    cancel: "Abbrechen",
    harvest: "Ernten",
    delete: "Löschen",
    loading: "Laden...",
    noCrops: "Keine Kulturen gefunden. Starten Sie jetzt!",
    harvestDue: "Ernte fällig",
    harvestOverdue: "Überfällig",
    harvestSoon: "Bald fällig",
    harvested: "Geerntet",
    growing: "Wächst",
    unit: "Einheit",
    field: "Feld",
    greenhouse: "Gewächshaus",
    tunnel: "Folientunnel",
    week: "Woche",
    today: "Heute",
    totalHarvest: "Gesamternte",
    cropsStarted: "Kulturen gestartet",
    welcome: "Willkommen zurück",
    weatherError: "Wetterdaten nicht verfügbar",
    resetData: "Alle Daten löschen",
    resetConfirm: "Sind Sie sicher? Alle Daten gehen verloren.",
    inProgress: "In Bearbeitung",
    dateRange: "Zeitraum",
    quantity: "Menge",
    harvestActionTitle: "Ernte erfassen",
    harvestActionDesc: "Wie viel wurde geerntet?",
    harvestPartial: "Teilernte (Kultur bleibt aktiv)",
    harvestFull: "Volle Ernte (Abschließen)",
    amountHarvested: "Geerntete Menge",
    remainingAmount: "Verbleibende Menge",
    confirm: "Bestätigen"
  },
  en: {
    dashboard: "Dashboard",
    crops: "Crops",
    newCrop: "New Crop",
    settings: "Settings",
    activeCrops: "Active Crops",
    plannedHarvests: "Planned Harvests",
    weather: "Weather",
    culture: "Crop",
    variety: "Variety",
    plantWeek: "Plant Week",
    plantYear: "Plant Year",
    harvestWeek: "Harvest Week",
    harvestYear: "Harvest Year",
    location: "Location",
    expectedYield: "Exp. Yield",
    status: "Status",
    actions: "Actions",
    save: "Save",
    cancel: "Cancel",
    harvest: "Harvest",
    delete: "Delete",
    loading: "Loading...",
    noCrops: "No crops found. Start planting!",
    harvestDue: "Harvest Due",
    harvestOverdue: "Overdue",
    harvestSoon: "Coming Soon",
    harvested: "Harvested",
    growing: "Growing",
    unit: "Unit",
    field: "Field",
    greenhouse: "Greenhouse",
    tunnel: "Polytunnel",
    week: "Week",
    today: "Today",
    totalHarvest: "Total Harvest",
    cropsStarted: "Crops Started",
    welcome: "Welcome back",
    weatherError: "Weather data unavailable",
    resetData: "Reset All Data",
    resetConfirm: "Are you sure? All data will be lost.",
    inProgress: "In Progress",
    dateRange: "Date Range",
    quantity: "Quantity",
    harvestActionTitle: "Record Harvest",
    harvestActionDesc: "How much was harvested?",
    harvestPartial: "Partial Harvest (Keep Active)",
    harvestFull: "Full Harvest (Complete)",
    amountHarvested: "Amount Harvested",
    remainingAmount: "Remaining Expected",
    confirm: "Confirm"
  },
  es: {
    dashboard: "Panel",
    crops: "Cultivos",
    newCrop: "Nuevo Cultivo",
    settings: "Configuración",
    activeCrops: "Cultivos Activos",
    plannedHarvests: "Cosechas Planificadas",
    weather: "Clima",
    culture: "Cultivo",
    variety: "Variedad",
    plantWeek: "Sem. Siembra",
    plantYear: "Año Siembra",
    harvestWeek: "Sem. Cosecha",
    harvestYear: "Año Cosecha",
    location: "Ubicación",
    expectedYield: "Ctd. Esperada",
    status: "Estado",
    actions: "Acciones",
    save: "Guardar",
    cancel: "Cancelar",
    harvest: "Cosechar",
    delete: "Eliminar",
    loading: "Cargando...",
    noCrops: "No se encontraron cultivos.",
    harvestDue: "Cosechar Ahora",
    harvestOverdue: "Atrasado",
    harvestSoon: "Próximamente",
    harvested: "Cosechado",
    growing: "Creciendo",
    unit: "Unidad",
    field: "Campo",
    greenhouse: "Invernadero",
    tunnel: "Túnel",
    week: "Semana",
    today: "Hoy",
    totalHarvest: "Cosecha Total",
    cropsStarted: "Cultivos Iniciados",
    welcome: "Bienvenido",
    weatherError: "Clima no disponible",
    resetData: "Restablecer Datos",
    resetConfirm: "¿Estás seguro? Se perderán todos los datos.",
    inProgress: "En Progreso",
    dateRange: "Fechas",
    quantity: "Cantidad",
    harvestActionTitle: "Registrar Cosecha",
    harvestActionDesc: "¿Cuánto se cosechó?",
    harvestPartial: "Parcial (Mantener Activo)",
    harvestFull: "Total (Finalizar)",
    amountHarvested: "Cantidad Cosechada",
    remainingAmount: "Restante Esperado",
    confirm: "Confirmar"
  },
  fr: {
    dashboard: "Tableau de bord",
    crops: "Cultures",
    newCrop: "Nouvelle Culture",
    settings: "Paramètres",
    activeCrops: "Cultures Actives",
    plannedHarvests: "Récoltes Prévues",
    weather: "Météo",
    culture: "Culture",
    variety: "Variété",
    plantWeek: "Sem. Plantation",
    plantYear: "Année Plantation",
    harvestWeek: "Sem. Récolte",
    harvestYear: "Année Récolte",
    location: "Emplacement",
    expectedYield: "Rendement Prévu",
    status: "Statut",
    actions: "Actions",
    save: "Enregistrer",
    cancel: "Annuler",
    harvest: "Récolter",
    delete: "Supprimer",
    loading: "Chargement...",
    noCrops: "Aucune culture trouvée.",
    harvestDue: "Récolter Maintenant",
    harvestOverdue: "En Retard",
    harvestSoon: "Bientôt",
    harvested: "Récolté",
    growing: "En Croissance",
    unit: "Unité",
    field: "Champ",
    greenhouse: "Serre",
    tunnel: "Tunnel",
    week: "Semaine",
    today: "Aujourd'hui",
    totalHarvest: "Récolte Totale",
    cropsStarted: "Cultures Lancées",
    welcome: "Bienvenue",
    weatherError: "Météo indisponible",
    resetData: "Réinitialiser",
    resetConfirm: "Êtes-vous sûr ? Toutes les données seront perdues.",
    inProgress: "En Cours",
    dateRange: "Période",
    quantity: "Quantité",
    harvestActionTitle: "Enregistrer la récolte",
    harvestActionDesc: "Combien a été récolté ?",
    harvestPartial: "Partielle (Garder Actif)",
    harvestFull: "Totale (Terminer)",
    amountHarvested: "Quantité Récoltée",
    remainingAmount: "Reste Prévu",
    confirm: "Confirmer"
  },
  pt: {
    dashboard: "Painel",
    crops: "Cultivos",
    newCrop: "Novo Cultivo",
    settings: "Configurações",
    activeCrops: "Cultivos Ativos",
    plannedHarvests: "Colheitas Planejadas",
    weather: "Previsão",
    culture: "Cultura",
    variety: "Variedade",
    plantWeek: "Sem. Plantio",
    plantYear: "Ano Plantio",
    harvestWeek: "Sem. Colheita",
    harvestYear: "Ano Colheita",
    location: "Localização",
    expectedYield: "Qtd. Esperada",
    status: "Status",
    actions: "Ações",
    save: "Salvar",
    cancel: "Cancelar",
    harvest: "Colher",
    delete: "Excluir",
    loading: "Carregando...",
    noCrops: "Nenhum cultivo encontrado.",
    harvestDue: "Colher Agora",
    harvestOverdue: "Atrasado",
    harvestSoon: "Em Breve",
    harvested: "Colhido",
    growing: "Crescendo",
    unit: "Unidade",
    field: "Campo",
    greenhouse: "Estufa",
    tunnel: "Túnel",
    week: "Semana",
    today: "Hoje",
    totalHarvest: "Colheita Total",
    cropsStarted: "Cultivos Iniciados",
    welcome: "Bem-vindo de volta",
    weatherError: "Clima indisponível",
    resetData: "Resetar Dados",
    resetConfirm: "Tem certeza? Todos os dados serão perdidos.",
    inProgress: "Em Andamento",
    dateRange: "Período",
    quantity: "Quantidade",
    harvestActionTitle: "Registrar Colheita",
    harvestActionDesc: "Quanto foi colhido?",
    harvestPartial: "Parcial (Manter Ativo)",
    harvestFull: "Total (Finalizar)",
    amountHarvested: "Quantidade Colhida",
    remainingAmount: "Restante Esperado",
    confirm: "Confirmar"
  }
};

const listeners = new Set<(lang: Language) => void>();

export const setGlobalLanguage = (lang: Language) => {
  localStorage.setItem('solawi_lang', lang);
  listeners.forEach((l) => l(lang));
};

export const useTranslation = () => {
  const [lang, setLang] = useState<Language>(
    (localStorage.getItem('solawi_lang') as Language) || 'de'
  );

  useEffect(() => {
    const handler = (l: Language) => setLang(l);
    listeners.add(handler);
    return () => {
      listeners.delete(handler);
    };
  }, []);

  const t = (key: keyof typeof translations['de']) => {
    // @ts-ignore
    return translations[lang]?.[key] || translations['en']?.[key] || key;
  };

  return { t, lang, setLang: setGlobalLanguage };
};